
 {% extends  "maps/base.html" %}

 {% block content %}
 <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
 <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css">
 <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

    <style>
      .geocoder {
         position: absolute;
         z-index: 1;
         width: 50%;
         left: 50%;
         margin-left: -25%;
         top: 10px;
      }
      .mapboxgl-ctrl-geocoder {
      min-width: 100%;
      }
      #map {
      margin-top: 75px;
      }
   </style>
         


    <div id='map' style='width: 100; height: 800px;'></div>
    <div id="geocoder" class="geocoder"></div>
    <script>

        <!--Mapbox-->
        mapboxgl.accessToken = '{{ mapbox_access_token }}';//access token
        var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/skup2506/ckl8epxj02oyt17s1vb1ghpnn',  //mapbox style URL
        center: [10.404, 63.417],
        zoom: 12
        });
        var coordinatesGeocoder = function (query) {
            // match anything which looks like a decimal degrees coordinate pair
            var matches = query.match(
               /^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
            );
            if (!matches) {
               return null;
            }
            function coordinateFeature(lng, lat) {
               return {
                  center: [lng, lat],
                  geometry: {
                  type: 'Point',
                  coordinates: [lng, lat]
                  },
                  place_name: 'Lat: ' + lat + ' Lng: ' + lng,
                  place_type: ['coordinate'],
                  properties: {},
                  type: 'Feature'
                  };
            }
            var coord1 = Number(matches[1]);
            var coord2 = Number(matches[2]);
            var geocodes = [];
            
            if (coord1 < -90 || coord1 > 90) {
            // must be lng, lat
            geocodes.push(coordinateFeature(coord1, coord2));
            }
            
            if (coord2 < -90 || coord2 > 90) {
            // must be lat, lng
            geocodes.push(coordinateFeature(coord2, coord1));
            }
            
            if (geocodes.length === 0) {
            // else could be either lng, lat or lat, lng
            geocodes.push(coordinateFeature(coord1, coord2));
            geocodes.push(coordinateFeature(coord2, coord1));
            }
            
            return geocodes;
            };

         map.addControl(
            new MapboxGeocoder({
               accessToken: mapboxgl.accessToken,
               localGeocoder: coordinatesGeocoder,
               zoom: 4,
               placeholder: 'Try: 10.393445, 63.428513',
               mapboxgl: mapboxgl
               })
            );

        //MapMouseEvent and marker
        map.on('click', function(e) {
            // The event object (e) contains information like the
            // coordinates of the point on the map that was clicked.
            
            //console.log('A click event has occurred at ' + e.lngLat + e.lngLat.lng);
            
            //marker
            var marker = new mapboxgl.Marker()
                    .setLngLat([e.lngLat.lng, e.lngLat.lat])
                    .addTo(map);
                    
            //pop-up 
            new mapboxgl.Popup()
            .setLngLat([e.lngLat.lng, e.lngLat.lat])
            .setHTML("<h1>Hello World!</h1>")
            .addTo(map);
        });

   </script>

{% endblock content %}
