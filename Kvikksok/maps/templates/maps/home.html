
 {% extends  "maps/base.html" %}
 

 {% block content %}

    <h1>Sjekk ditt område:</h1>
    <div>
        <form method="get">
            <input type="text" id="id_query" placeholder="postnummer">
            <button type="button" onclick="getGeojson_points()">Søk</button>
            <button type="button" onclick= "addMarker()">Add marker</button>
        </form>
    </div>



    <div id='map' style='width: 100%; height: 800px;'>
        <script>
            //import postnummer from "./postnummer.geojson"

            <!--Mapbox-->
            mapboxgl.accessToken = '{{ mapbox_access_token }}';//access token
            var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/skup2506/ckl8epxj02oyt17s1vb1ghpnn',  //mapbox style URL
            center: [10.404, 63.417],
            zoom: 12
            });

            //NavigationControl
            var nav = new mapboxgl.NavigationControl();
            var addmarker_boolen = false; 
            map.addControl(nav, 'top-left');

            //allows user to add a marker
            function addMarker() {
                addmarker_boolen = true;
                console.log('addmarker is ' + addmarker_boolen)
            }

            
            //MapMouseEvent and marker
            map.on('click', function(e) {
                if (addmarker_boolen == true) {
                    var marker = new mapboxgl.Marker({
                            color: '#004fa4',
                            draggable: true
                        })
                        .setLngLat([e.lngLat.lng, e.lngLat.lat])
                        .setPopup(
                            new mapboxgl.Popup({})
                            .setLngLat([e.lngLat.lng, e.lngLat.lat])
                            .setHTML("<h1>Hello World!</h1>").addTo(map))
                        .addTo(map);

                    addmarker_boolen = false;                
                }
            
            });
        
            


            function getGeojson_points() {

                map.addSource('postnummer',{
                        type: 'geojson',
                        data: {
                                "type": "FeatureCollection",
                                "name": "postNummer",
                                //"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                                "features": [
                                    { "type": "Feature", "properties": { "postnummer": 1354, "poststed": "B�RUMS VERK" }, "geometry": { "type": "Point", "coordinates": [ 10.495188707896558, 59.942997421825446 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 2092, "poststed": "MINNESUND" }, "geometry": { "type": "Point", "coordinates": [ 11.230517825998556, 60.427781233028846 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 3536, "poststed": "NORESUND" }, "geometry": { "type": "Point", "coordinates": [ 9.602099500044879, 60.230940730555595 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 274, "poststed": "OSLO" }, "geometry": { "type": "Point", "coordinates": [ 10.692964774885331, 59.924863418008385 ] } }
                                    ] 
                                }
                }); 

                map.addLayer({
                    id: 'postnummer_senter  ',
                    type: 'circle',
                    source: 'postnummer',
                    'paint': {
                    'circle-radius': 6,
                    'circle-color': '#B42222'
                    },
                    'filter': ['==', '$type', 'Point']
                });  
            }




        </script>
   </div>

{% endblock content %}
