
 {% extends  "maps/base.html" %}
 

 {% block content %}

   <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
   <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css">
   <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

    <h1>Sjekk ditt område:</h1>
    <div>
        <form method="get">
            <button type="button" onclick="getGeojson_points()">Lagrede postnummer</button>
            <button type="button" onclick= "addMarker()">Legg til punkt</button>
        </form>
    </div>

    <div id='map' style='width: 100%; height: 700px;'>


        
        <script>
            //import postnummer from "./postnummer.geojson"
            <!--Mapbox-->
            mapboxgl.accessToken = '{{ mapbox_access_token }}';//access token
            var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/skup2506/ckl8epxj02oyt17s1vb1ghpnn',  //mapbox style URL
            center: [10.404, 63.417],
            zoom: 12
            });
               
            map.addControl(

                new MapboxGeocoder({
                    accessToken: mapboxgl.accessToken,
                    mapboxgl: mapboxgl,
                    placeholder: 'Stedsnavn'
                })
            );

            //NavigationControl
            var nav = new mapboxgl.NavigationControl();
            var addmarker_boolen = false; 
            map.addControl(nav, 'top-left');

            //allows user to add a marker
            function addMarker() {
                addmarker_boolen = true;
                console.log('addmarker is ' + addmarker_boolen)
            }


            /*
            var div = window.document.createElement('div');
            div.innerHTML = 'Hello, world!';
            var popup = new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setDOMContent(div)
            .addTo(map);
            */


            //MapMouseEvent and marker
            map.on('click', function(e) {
                if (addmarker_boolen == true) {

                    var div = window.document.createElement('div');
                    var data="<form id='post'>Name:<br><input type='text' name='name'><br>Comment:<br><textarea rows='5' cols='50' name='textmsg'></textarea><br><input type='submit' value='comment'></from>"
                    console.log(document.getElementById('post'))
                    div.innerHTML = data;

                    
                    var marker = new mapboxgl.Marker({
                            color: '#004fa4',
                            draggable: true
                        })
                        .setLngLat([e.lngLat.lng, e.lngLat.lat])
                        .setPopup(
                            new mapboxgl.Popup({})
                            .setLngLat([e.lngLat.lng, e.lngLat.lat])
                            .setDOMContent(div))
                            //.setHTML("<h1>Hello World!</h1>").addTo(map))
                        .addTo(map);

                    addmarker_boolen = false;                
                }
            
            });
        
            

            function getGeojson_points() {

                map.addSource('postnummer',{
                        type: 'geojson',
                        data: {
                                "type": "FeatureCollection",
                                "name": "postNummer",
                                //"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                                "features": [
                                    { "type": "Feature", "properties": { "postnummer": 1354, "poststed": "B�RUMS VERK" }, "geometry": { "type": "Point", "coordinates": [ 10.495188707896558, 59.942997421825446 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 2092, "poststed": "MINNESUND" }, "geometry": { "type": "Point", "coordinates": [ 11.230517825998556, 60.427781233028846 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 3536, "poststed": "NORESUND" }, "geometry": { "type": "Point", "coordinates": [ 9.602099500044879, 60.230940730555595 ] } },
                                    { "type": "Feature", "properties": { "postnummer": 274, "poststed": "OSLO" }, "geometry": { "type": "Point", "coordinates": [ 10.692964774885331, 59.924863418008385 ] } }
                                    ] 
                                }
                }); 

                map.addLayer({
                    id: 'postnummer_senter  ',
                    type: 'circle',
                    source: 'postnummer',
                    'paint': {
                    'circle-radius': 6,
                    'circle-color': '#B42222'
                    },
                    'filter': ['==', '$type', 'Point']
                });  
            }

        </script>
   </div>

{% endblock content %}
